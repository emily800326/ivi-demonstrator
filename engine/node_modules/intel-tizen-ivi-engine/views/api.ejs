var <%= className %> = (function (){
    function <%= className %> () {
		console.info("Starting up service <%= className %>");
	}

	<%= className %>.prototype = function () {
		this.basePath = window.location.origin;
	}

	<%= className %>.prototype.basePath = window.location.protocol + "//" + window.location.host; //"http://localhost:<%= port -%>";

	<% actions.forEach(function(aAction) { -%>	
	    <% if (!!aAction.apiMethod) { -%>
	    <% var signature = className + ".prototype." + aAction.apiMethod; %>
	// <%= aAction.title -%>
		<% if (aAction.type == "get") { %>
			<% if (aAction.parameters) { %>
				<%= signature %> = function (<% aAction.parameters.forEach(function(aParameter) { -%>
	<%= aParameter.name -%>,
	<% }); %>  callback) {
					var paramsArray = [];
					<% aAction.parameters.forEach(function(aParameter) { -%>
					paramsArray.push('<%= aParameter.name -%>' + "=" + encodeURIComponent(<%= aParameter.name -%>));
					<% }); %>
					var text = paramsArray.join('&');
					return $.getJSON(this.basePath + "<%= basePath %><%= aAction.endpoint %>"+"?"+text, function(jsonString) {
						try {
						callback(jsonString);
						} catch (ex) {
							console.error(ex);
						}
					});
				}
			<% } else { %>
				<%= signature %> = function (callback) {
					return $.getJSON(this.basePath + "<%= basePath %><%= aAction.endpoint %>", function(jsonString) {
						try {
						callback(jsonString);
						} catch (ex) {
							console.error(ex);
						}
					});
				}
			<%} -%>
		<%} -%>

		<% if (aAction.type == "post") { %>
	<%= signature %> = function ( <% aAction.parameters.forEach(function(aParameter) { -%>
	<%= aParameter.name -%>,
	<% }); %> callback) {
		return $.post(this.basePath + "<%= basePath %><%= aAction.endpoint %>", {
			<% aAction.parameters.forEach(function(aParameter) { -%>
		<%= aParameter.name %>: <%= aParameter.name %> || "<%= aParameter.value %>",
			<%  }); -%>
	}, function(jsonString) {
						try {
						callback(jsonString);
						} catch (ex) {
							console.error(ex);
						}});
	}
		<%} -%>

		<% if (aAction.type == "navigate") { %>
	<%= signature %> = function ( <% aAction.parameters.forEach(function(aParameter) { -%>
	<%= aParameter.name -%>,
	<% }); %> callback) {

		window.location.href = "<%= basePath %><%= aAction.endpoint %>?" <% if (aAction.parameters.length > 0) { -%>
		+ <% aAction.parameters.forEach(function(aParameter) { -%>"<%= aParameter.name %>=" + <%= aParameter.name %> + "&" <%}); %> + "";
		<% } %>
	}
		<%} -%>

		<% if (aAction.type == "event") { %>
	<%= signature %> = function (callback) {
		var firstInstance = ApiEndpointBase.addIviEventSourceListener(<%= port %>, "<%= className %>/<%= aAction.message %>", callback);
		<% if (!!aAction.endpoint) { // Force invocation of remote method on call %>
			//if (firstInstance) {
				console.info("Forcing first update")
				$.get(this.basePath + "<%= basePath %><%= aAction.endpoint %>", function() {
					console.info("First update return.")
				});
			//}
		<% } %>
	}
		<%} -%>

		<%} -%>
	<% }); -%>

	return <%= className %>;
})();