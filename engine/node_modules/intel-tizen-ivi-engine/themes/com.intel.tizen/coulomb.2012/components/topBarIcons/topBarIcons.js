/**
 * @namespace com.intel.tizen.coulomb.2012
 **/
/** 
 * Array of applications that will be rendered to the top bar panel.
 * @property topBarAplicationsModel
 * @type {Array}
 * @for global
 */
var topBarAplicationsModel = [{
	id: "http://com.intel.tizen/back",
	appName: "back",
	css: "appIconNo",
	installed: true
}, {
	id: "http://com.intel.tizen/navigationgoogle",
	appName: "navigation",
	css: "appIconNo0",
	installed: false
}, {
	id: "http://com.intel.tizen/dashboard",
	appName: "dashboard",
	css: "appIconNo1",
	installed: false
}, {
	id: "http://com.intel.tizen/musicplayer",
	appName: "musicplayer",
	css: "appIconNo2",
	installed: false
}, {
	id: "http://com.intel.tizen/videoplayer",
	appName: "videoplayer",
	css: "appIconNo3",
	installed: false
}, {
	id: "http://com.intel.tizen/phone",
	appName: "phone",
	css: "appIconNo4",
	installed: false
}, {
	id: "http://com.intel.tizen/social",
	appName: "social",
	css: "appIconNo5",
	installed: false
}, {
	id: "http://com.intel.tizen/dashboard",
	appName: "dashboard",
	css: "appIconNo6",
	installed: false
}, {
	id: "http://com.intel.tizen/settings",
	appName: "settings",
	css: "appIconNo7",
	installed: true,
	lastIcon: true
}];

(function ($) {
	/**
	 * Represents top bar UI control element that is used to navigate between predefined set of applications.
	 * @class TopBarIcons
	 * @constructor
	 */
	var TopBarIcons = {
			/** 
			 * Name of the application that is used to highlight only the icon of currently running application.
			 * @property runningAppName
			 * @type {String}
			 * @default ""
			 */
			runningAppName: "",

			/**
			 * Initializes the element and gets the list of installed application.
			 * 
			 * @method init
			 * @param appName {String} Name of running application.
			 */
			init: function (appName) {
				TopBarIcons.runningAppName = appName;

				this.empty();
				this.addClass("topBarIcons");

				if (typeof tizen == 'undefined') {
					console.warn("Tizen API not found, linking stub APIs");
					loadScript('../../tizenApplication.js', function (path, status) {
						if (status == "ok") {
							try {
								tizen.application.getAppsInfo(TopBarIcons.onAppInfoSuccess, onError);
							} catch (exc) {
								console.error(exc.message);
							}
						}
					});
				} else {
					try {
						tizen.application.getAppsInfo(TopBarIcons.onAppInfoSuccess, onError);
					} catch (exc) {
						console.error(exc.message);
					}
				}
			},
			/**
			 * The callback to be invoked when the installed application list is retrieved. Compares list of installed applications to predefined list and sets installed and running properties, that are used when launching an application.
			 * Calls render application icons function.
			 * @method onAppInfoSuccess
			 * @param list {Array} Array of installed application.
			 */
			onAppInfoSuccess: function (list) {
				try {
					var i = 0, j = 0;
					for (i = 0; i < list.length; i++) {
						for (j = 0; j < topBarAplicationsModel.length; ++j) {
							if (list[i].id == topBarAplicationsModel[j].id) {
								topBarAplicationsModel[j].installed = true;
								break;
							}
						}
					}
					for (j = 0; j < topBarAplicationsModel.length; ++j) {
						if (TopBarIcons.runningAppName == topBarAplicationsModel[j].appName) {
							topBarAplicationsModel[j].running = true;
						} else {
							topBarAplicationsModel[j].running = false;
						}
					}
					loadScript('../../css/car/components/jsViews/jsrender.js', function (path, status) {
						if (status == "ok") {
							loadScript('../../css/car/components/jsViews/template.js', function (path, status) {
								if (status == "ok") {
									TopBarIcons.renderApps();
								}
							});
						}
					});
				} catch (exc) {
					console.error(exc.message);
				}
			},
			/**
			 * Renders the array of predefined applications into the panel utilizing template mechanism.
			 * 
			 * @method renderApps
			 * @param caption {String} Caption text.
			 */
			renderApps: function () {
				template.compile(topBarAplicationsModel, "../../css/car/components/topBarIcons/templates/topBarIconsDelegate.html", ".topBarIcons", function () {
					var j = 0;
					for (j = 0; j < topBarAplicationsModel.length; ++j) {
						if (topBarAplicationsModel[j].running) {
							changeCssBgImageColor("." + topBarAplicationsModel[j].css, ThemeKeyColorSelected);
						} else {
							changeCssBgImageColor("." + topBarAplicationsModel[j].css, ThemeKeyColor);
						}
					}
				});
			}
		};

	/** 
	 * jQuery extension method for class `com.intel.tizen.coulomb.2012.topBarIconsPlugin`
	 * @param method {Object|jQuery selector} Identificator (name) of method or jQuery selector.
	 * @method topBarIconsPlugin
	 * @for jQuery
	 * @return Result of called method.
	 */
	$.fn.topBarIconsPlugin = function (method) {
		// Method calling logic
		if (TopBarIcons[method]) {
			return TopBarIcons[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return TopBarIcons.init.apply(this, arguments);
		} else {
			$.error('Method ' + method + ' does not exist on jQuery.boxCaptionPlugin');
		}
	};
}(jQuery));

/**
 * Returns the application object by application id from topBarAplicationsModel.
 * 
 * @method getAppByID
 * @for global
 * @param id {String} Application ID.
 */
function getAppByID(id) {
	var j = 0;
	for (j = 0; j < topBarAplicationsModel.length; ++j) {
		if (id == topBarAplicationsModel[j].id) {
			return topBarAplicationsModel[j];
		}
	}
	return null;
}

/**
 * The callback to be invoked when the application was launched successfully.
 * 
 * @method onAppInfoSuccess
 * @for global
 * @param list {Array} Array of installed application.
 */
function onLaunchSuccess() {
	console.log("App launched succesfully...");
}

/**
 * The callback to be invoked when the application was not launched successfully.
 * 
 * @method onError
 * @for global
 * @param list {Array} Array of installed application.
 */
function onError(err) {
	console.error(err.message);
}

/**
 * Launches an application with the given application ID.
 * 
 * @method launchApplication
 * @for global
 * @param id {String} Application ID.
 */
function launchApplication(id) {
	if (id == "http://com.intel.tizen/back") {
		tizen.application.exit();
		return;
	}

	if (id == "http://com.intel.tizen/settings") {
		if (typeof Settings == 'undefined') {
			loadScript('../../css/car/components/settings/js/settings.js', function (path, status) {
				if (status == "ok") {
					Settings.init();
				}
			});
		} else {
			if (!Settings.initialized) {
				Settings.init();
			} else {
				Settings.show();
			}
		}
		return;
	}

	var app = getAppByID(id);
	if (app.installed && !app.running) {
		tizen.application.launch(app.id, onLaunchSuccess, onError);
	} else if (app.running) {
		console.log("Application is running!");
		alert("Application is running!");
	} else {
		console.log("Application is not installed!");
		alert("Application is not installed!");
	}
}