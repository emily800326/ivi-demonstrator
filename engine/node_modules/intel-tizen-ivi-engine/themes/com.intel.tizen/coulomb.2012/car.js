function loadScript(path, callback) {
    var scripts = document.getElementsByTagName("script"), i = 0;

    for (i = 0; i < scripts.length; i++) {
        if (scripts[i].src == path) {
            callback(path, "ok");
            return;
        }
    }

    var done = false;
    var scr = document.createElement('script');

    scr.onload = handleLoad;
    scr.onreadystatechange = handleReadyStateChange;
    scr.onerror = handleError;
    scr.src = path;
    scr.type = "text/javascript";

    document.getElementsByTagName('head')[0].appendChild(scr);

    function handleLoad() {
        if (!done) {
            done = true;
            if (callback != null) {
                callback(path, "ok");
            }
        }
    }

    function handleReadyStateChange() {
        var state;

        if (!done) {
            state = scr.readyState;
            if (state === "complete") {
                handleLoad();
            }
        }
    }

    function handleError() {
        if (!done) {
            done = true;
            if (callback != null) {
                callback(path, "error");
            }
        }
    }
}

function checkIfIncluded(file) {
    var links = document.getElementsByTagName("link"), i = 0;

    for (i = 0; i < links.length; i++) {
        if (links[i].href.substr(-file.length) == file) {
            return true;
        }
    }

    var scripts = document.getElementsByTagName("script");
    for (i = 0; i < scripts.length; i++) {
        if (scripts[i].src.substr(-file.length) == file) {
            return true;
        }
    }

    return false;
}


function changeCssBgImageColor(selector, bgcolor) {
    var imageSource = $(selector).css('background-image');

    var patt = /\"|\'|\)|\(|url/g;	//remove 'url' and '()' from background-image property	
    imageSource = imageSource.replace(patt, '');

    var img = new Image();
    var ctx = document.createElement('canvas').getContext('2d');

    img.onload = function () {
        var w = ctx.canvas.width = img.width;
        var h = ctx.canvas.height = img.height;
        ctx.fillStyle = bgcolor || ThemeKeyColor;
        ctx.fillRect(0, 0, w, h);
        ctx.globalCompositeOperation = 'destination-in';
        ctx.drawImage(img, 0, 0);

        $(selector).css('background-image', 'url(' + ctx.canvas.toDataURL() + ')');
        $(selector).css('visibility', 'visible');
    };
    img.src = imageSource;
}