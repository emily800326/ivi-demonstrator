<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\routes\abstractService.ts - Intel Tizen IVI Engine</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="https:&#x2F;&#x2F;www.tizen.org&#x2F;sites&#x2F;all&#x2F;themes&#x2F;tizen_theme&#x2F;logo.png" title="Intel Tizen IVI Engine"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.2012105.151454</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/AbstractService.AbstractService.html">AbstractService.AbstractService</a></li>
            
                <li><a href="..&#x2F;classes/AbstractService.AbstractServiceOptions.html">AbstractService.AbstractServiceOptions</a></li>
            
                <li><a href="..&#x2F;classes/AbstractService.EndpointAction.html">AbstractService.EndpointAction</a></li>
            
                <li><a href="..&#x2F;classes/AbstractService.EndpointActionParameter.html">AbstractService.EndpointActionParameter</a></li>
            
                <li><a href="..&#x2F;classes/ApiEndpointBase.ApiEndpointBase.html">ApiEndpointBase.ApiEndpointBase</a></li>
            
                <li><a href="..&#x2F;classes/AudioService.AudioService.html">AudioService.AudioService</a></li>
            
                <li><a href="..&#x2F;classes/AudioService.StatusData.html">AudioService.StatusData</a></li>
            
                <li><a href="..&#x2F;classes/CarIndicatorService.CarIndicatorService.html">CarIndicatorService.CarIndicatorService</a></li>
            
                <li><a href="..&#x2F;classes/CarIndicatorService.RandomizerData.html">CarIndicatorService.RandomizerData</a></li>
            
                <li><a href="..&#x2F;classes/CarIndicatorService.StatusData.html">CarIndicatorService.StatusData</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.AlphabetBookmark.html">com.intel.tizen.coulomb.2012.AlphabetBookmark</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.AudioPlayer.html">com.intel.tizen.coulomb.2012.AudioPlayer</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.BottomPanel.html">com.intel.tizen.coulomb.2012.BottomPanel</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.BoxCaption.html">com.intel.tizen.coulomb.2012.BoxCaption</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.ButtonControlsObj.html">com.intel.tizen.coulomb.2012.ButtonControlsObj</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Carousel.html">com.intel.tizen.coulomb.2012.Carousel</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Clock.html">com.intel.tizen.coulomb.2012.Clock</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.ClockPlugin.html">com.intel.tizen.coulomb.2012.ClockPlugin</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.global.html">com.intel.tizen.coulomb.2012.global</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.jQuery.html">com.intel.tizen.coulomb.2012.jQuery</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Library.html">com.intel.tizen.coulomb.2012.Library</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.MusicLibraryFileSystem.html">com.intel.tizen.coulomb.2012.MusicLibraryFileSystem</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.progressBarPlugin.html">com.intel.tizen.coulomb.2012.progressBarPlugin</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Settings.html">com.intel.tizen.coulomb.2012.Settings</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Tabs.html">com.intel.tizen.coulomb.2012.Tabs</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Themes.html">com.intel.tizen.coulomb.2012.Themes</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.TopBarIcons.html">com.intel.tizen.coulomb.2012.TopBarIcons</a></li>
            
                <li><a href="..&#x2F;classes/Engine.Server.html">Engine.Server</a></li>
            
                <li><a href="..&#x2F;classes/EventSourceDispatcher.EventSourceDispatcher.html">EventSourceDispatcher.EventSourceDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/EventSourceDispatcher.EventUpdateData.html">EventSourceDispatcher.EventUpdateData</a></li>
            
                <li><a href="..&#x2F;classes/HomeScreenService.HomeScreenService.html">HomeScreenService.HomeScreenService</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.AvailablePackageData.html">PackageRepositoryService.AvailablePackageData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.CategoryData.html">PackageRepositoryService.CategoryData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.InstalledPackageData.html">PackageRepositoryService.InstalledPackageData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.PackageEventData.html">PackageRepositoryService.PackageEventData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.PackageRepositoryOptions.html">PackageRepositoryService.PackageRepositoryOptions</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.PackageRepositoryService.html">PackageRepositoryService.PackageRepositoryService</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.ThemeData.html">PackageRepositoryService.ThemeData</a></li>
            
                <li><a href="..&#x2F;classes/PersistentConsole.console.html">PersistentConsole.console</a></li>
            
                <li><a href="..&#x2F;classes/ThemeEngineService.ThemeEngineService.html">ThemeEngineService.ThemeEngineService</a></li>
            
                <li><a href="..&#x2F;classes/TizenApplicationStubService.TizenApplicationStubService.html">TizenApplicationStubService.TizenApplicationStubService</a></li>
            
                <li><a href="..&#x2F;classes/UserStatusService.UserDetails.html">UserStatusService.UserDetails</a></li>
            
                <li><a href="..&#x2F;classes/UserStatusService.UserSettings.html">UserStatusService.UserSettings</a></li>
            
                <li><a href="..&#x2F;classes/UserStatusService.UserStatusService.html">UserStatusService.UserStatusService</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\routes\abstractService.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;&#x2F;&#x2F; &lt;reference path=&#x27;..&#x2F;extern&#x2F;node.d.ts&#x27;&#x2F;&gt;
&#x2F;&#x2F;&#x2F; &lt;reference path=&#x27;..&#x2F;extern&#x2F;express.d.ts&#x27;&#x2F;&gt;
&#x2F;&#x2F;&#x2F; &lt;reference path=&#x27;..&#x2F;extern&#x2F;fakeEmitter.d.ts&#x27;&#x2F;&gt;

&#x2F;**
 * @namespace AbstractService
 *&#x2F;

import util = module(&quot;util&quot;);
import express = module(&quot;express&quot;);
import eventSourceDispatcher = module(&quot;..&#x2F;eventSourceDispatcher&quot;);
var EventSourceChannelResponse: express.ExpressServerResponse;

var log4js = require(&#x27;log4js&#x27;),
    jsp = require(&quot;uglify-js&quot;).parser,
    pro = require(&quot;uglify-js&quot;).uglify,
    _EventEmitter = require(&quot;events&quot;).EventEmitter;

&#x2F;**
* Wraps AbstractService options
* @class AbstractServiceOptions
*&#x2F;
export interface AbstractServiceOptions {
    &#x2F;** 
    * Name of service.
    * @property name
    * @type {String}
    *&#x2F;
    name: string;
    &#x2F;** 
    * Service HTTP endpoint prefix.
    * @property endpointName
    * @default Lowercased name
    * @optional
    * @type {String}
    *&#x2F;
    endpointName?: string;
    &#x2F;** 
    * Description of service.
    * @property description
    * @default name
    * @optional
    * @type {String}
    *&#x2F;
    description?: string;
    &#x2F;** 
    * Name of API class generated for this service.
    * @property apiClassName
    * @default name
    * @optional
    * @type {String}
    *&#x2F;
    apiClassName?: string;
    &#x2F;** 
    * Name of EJB view file used to display operations with service endpoint.
    * @property indexView
    * @default name
    * @optional
    * @type {String}
    *&#x2F;
    indexView?: string;
    &#x2F;** 
    * Name of EJB view file used to render API operations with service endpoint.
    * @property apiView
    * @default name
    * @optional
    * @type {String}
    *&#x2F;
    apiView?: string;
    &#x2F;** 
    * Instance of EventSourceDispatcher class used to send push notifications to HTML5 applications.
    * @property eventSourceDispatcher
    * @optional
    * @type {EventSourceDispatcher.EventSourceDispatcher}
    *&#x2F;
    eventSourceDispatcher?: eventSourceDispatcher.EventSourceDispatcher;
}

&#x2F;**
* Wraps single callback action parameter data.
* @class EndpointActionParameter
*&#x2F;
export interface EndpointActionParameter {
    &#x2F;** 
    * Parameter type. Due to IVI rendering limitations only &#x60;text&#x60; is supported at the moment.
    * @property type
    * @type {String}
    *&#x2F;
    type: string;
    &#x2F;** 
    * Parameter name
    * @property title
    * @type {String}
    *&#x2F;
    name: string;
    &#x2F;** 
    * Default value for parameter
    * @optional
    * @property value
    * @type {String}
    *&#x2F;
    value?: string;
    &#x2F;** 
    * Array of available values parameter
    * @optional
    * @property value
    * @type {String}
    *&#x2F;
    values?: string;
}

&#x2F;**
* Wraps parameters for single endpoint action.
* @class EndpointAction
*&#x2F;
export interface EndpointAction {
    &#x2F;** 
    * Endpoint type. One of &#x60;get&#x60;, &#x60;post&#x60;, &#x60;event&#x60; or &#x60;navigate&#x60;.
    * @property type
    * @type {String}
    *&#x2F;
    type: string;
    &#x2F;** 
    * Human-readable description of endpoint.
    * @property title
    * @type {String}
    *&#x2F;
    title: string;
    &#x2F;** 
    * HTTP endpoint definition, should be prefixed with &#x60;&#x2F;&#x60; (forward slash).
    * @optional
    * @default Lowercased title
    * @property endpoint
    * @type {String}
    *&#x2F;
    endpoint?: string;
    &#x2F;** 
    * Callback to method performing API operation.
    * @optional
    * @property callback
    * @type {Callback}
    * @param aRequest {ExpressServerRequest} Server request.
    * @param aResponse {ExpressServerResponse} Server response.
    *&#x2F;
    callback?: (req: express.ExpressServerRequest, res: express.ExpressServerResponse) =&gt; void;
    &#x2F;**
    * Array of endpoint action parameters.
    * @optional
    * @property parameters
    * @type {AbstractService.EndpointActionParameter[]}
    *&#x2F;
    parameters?: EndpointActionParameter[];
}

&#x2F;**
* Contains array of all attached service API endpoints.
* @property AttachedServices
* @type {AbstractService.AbstractServiceOptions[]}
*&#x2F;
export var AttachedServices: AbstractServiceOptions[] = [];

&#x2F;** 
* Provides base class for all API endpoints to share common infrastructure. &#x60;AbstractService&#x60; provides unified way to declare API endpoint that can
* be later easily reflected to HTML or JavaScript classes. Class also provide unified logging mechanism.
*
* By default class provides only two callback to retrieve JavaScript class and minified JavaScript class with reflected methods. Currently following 
* API endpoints types are supported:
* 
* * &#x60;[GET]&#x60; - HTTP GET request processing parameters from query string
* * &#x60;[POST]&#x60; - HTTP POST request processing parameters from body
* * &#x60;[EVENT]&#x60; - HTTP EventSource HTML5 push mechanism callback
* * &#x60;[NAVIGATE]&#x60; - HTTP GET request returning JavaScript snippet assumed to be executed on client side
* 
* In methods marked with such label arguments and return values indicates values coming in from server request and returned to server response 
* instead of actual parameters&#x2F;return values of method.
*
* All Services derived from this class are available on server address &#x60;&#x2F;[serviceName]&#x60; e.g. &#x60;http:&#x2F;&#x2F;localhost:8088&#x2F;themeEngine&#x60; (see &#x60;Server&#x60; for more details about server 
* location and configuration). All actions that can be performed on Service can be invoked either:
* 
* * directly from web browser by navigating to Service address (e.g. &#x60;http:&#x2F;&#x2F;localhost:8088&#x2F;themeEngine&#x60;) and pressing Invoke&#x2F;Submit button
* * manually by invoking e.g. curl call for parameters (e.g. &#x60;curl --data &quot;url=http:&#x2F;&#x2F;package.location.com&#x2F;package.name.wgt&quot; http:&#x2F;&#x2F;localhost:8088&#x2F;packageRepository&#x2F;installFromUrl &#x60;)
* 
* To add additional API methods use actions collection via push or splice method with object properties defined in &#x60;EndpointAction&#x60; object, e.g.
* 
*     this.actions.push({
*        type: &quot;get&quot;,
*        title: &quot;Get Data&quot;,
*        endpoint: &quot;&#x2F;getData&quot;,
*        callback: this.getData
*      });
*
* @class AbstractService
* @extends EventEmitter
* @constructor
*&#x2F;
export class AbstractService extends _EventEmitter {
    &#x2F;** 
    * Defines base path for API service in format &#x2F;service
    * @property basePath
    * @type {String}
    *&#x2F;
    public basePath: string;
    &#x2F;** 
    * Contains array of endpoing API actions attached to this service. Must be filled before calling attachApplication method.
    * @property actions
    * @type {AbstractService.EndpointAction[]}
    *&#x2F;
    public actions: EndpointAction[];
    &#x2F;** 
    * Declares log4js logger for this service.
    * @property logger
    * @type {log4js.logger}
    *&#x2F;
    public logger: any;
    &#x2F;** 
    * Declares server root application.
    * @property applicationRoot
    * @type {ExpressServer}
    *&#x2F;
    public applicationRoot: express.ExpressServer;

    &#x2F;** 
    * @method constructor
    * @param serviceOptions {AbstractService.AbstractServiceOptions} Service options.
    *&#x2F;
    constructor (private serviceOptions: AbstractServiceOptions) {
        super();
        this.serviceOptions.endpointName = serviceOptions.endpointName || serviceOptions.name.toLowerCase();
        this.serviceOptions.description = serviceOptions.description || serviceOptions.name;
        this.serviceOptions.apiClassName = serviceOptions.apiClassName || serviceOptions.name;
        this.serviceOptions.indexView = serviceOptions.indexView || &quot;apiConsole&quot;;
        this.serviceOptions.apiView = serviceOptions.apiView || &quot;api&quot;;
        this.basePath = util.format(&quot;&#x2F;%s&quot;, this.serviceOptions.endpointName);

        this.logger = log4js.getLogger(this.serviceOptions.name);
        this.logger.info(&quot;Starting up endpoint %j&quot;, this.serviceOptions);

        this.actions = [{
            type: &quot;api&quot;,
            title: &quot;Get API&quot;,
            endpoint: &quot;.js&quot;,
            callback: this.getApi
        }, {
            type: &quot;api&quot;,
            title: &quot;Get minified API&quot;,
            endpoint: &quot;.min.js&quot;,
            callback: this.getMinifiedApi
        }];

        AttachedServices.push(this.serviceOptions);
    }

    &#x2F;** 
    * Sends status update to HTML5 application attached to source. Client application will receive this message in form 
    * AbstractServiceOptions.apiClassName&#x2F;aSource.
    * @method sendStatus
    * @param aSource {String} Name of message source. 
    * @param aMessage {Object} Message data.
    *&#x2F;
    sendStatus(aSource: string, aMessage?: any) {
        if (!!this.serviceOptions.eventSourceDispatcher) {
            this.logger.info(&quot;Sending updated status: %j&quot;, aMessage);
            this.serviceOptions.eventSourceDispatcher.emit(&quot;send&quot;, {
                source: util.format(&quot;%s&#x2F;%s&quot;, this.serviceOptions.apiClassName, aSource),
                message: aMessage
            });
        } else {
            this.logger.error(&quot;Service option eventSourceDispatcher was not provided, cannot send status %s: %j&quot;, aSource, aMessage);
        }
    }

    &#x2F;** 
    * Attach this class endpoints to Express HTTP server application.
    * @method attachApplication
    * @param aApplication {ExpressApplication} Instance of Express application
    *&#x2F;
    attachApplication(aApplication: any) {
        var self = this;

        this.applicationRoot = aApplication;
        aApplication.get(this.basePath, this.index.bind(self));

        this.actions.forEach(function (aAction) {
            var endpoint = self.basePath + aAction.endpoint;
            if (!!aAction.callback) {
                self.logger.debug(&quot;Binding action %s [%s]: %s&quot;, aAction.title, aAction.type, endpoint);
                if (aAction.type == &quot;get&quot; || aAction.type == &quot;event&quot; || aAction.type == &quot;api&quot; || aAction.type == &quot;navigate&quot;) aApplication.get(endpoint, aAction.callback.bind(self));
                if (aAction.type == &quot;post&quot;) aApplication.post(endpoint, aAction.callback.bind(self));
            } else {
                self.logger.warn(&quot;No callback method defined for action %s [%s]: %s&quot;, aAction.title, aAction.type, endpoint);
            }
        });
    }

    &#x2F;**
    * &#x60;[GET] &#x2F;index.html&#x60; Returns index view console with all defined API operations
    * @method index
    *&#x2F;
    index(aRequest: express.ExpressServerRequest, aResponse: express.ExpressServerResponse) {
        aResponse.render(this.serviceOptions.indexView, {
            title: this.serviceOptions.description,
            actions: this.actions,
            basePath: this.basePath
        });
    };

    &#x2F;**
    * Returns unformatted JavaScript API view with all defined API operations
    * @method _getApi
    *&#x2F;
    private _getApi(aRequest: express.ExpressServerRequest, aResponse: express.ExpressServerResponse, aCallback: (err, str) =&gt; void ) {
        aResponse.header(&#x27;Content-Type&#x27;, &#x27;text&#x2F;javascript&#x27;);
        aResponse.render(this.serviceOptions.apiView, {
            className: this.serviceOptions.apiClassName,
            actions: this.actions,
            basePath: this.basePath,
            port: this.applicationRoot.get(&quot;port&quot;)
        }, aCallback);
    }

    &#x2F;**
    * &#x60;[GET] .min.js&#x60; Returns minified JavaScript API view with all defined API operations
    * @method getMinifiedApi
    *&#x2F;
    getMinifiedApi(aRequest: any, aResponse: express.ExpressServerResponse) {
        this._getApi(aRequest, aResponse, function (err, str) {
            if (err) return aRequest.next(err);
            var ast = jsp.parse(str);
            ast = pro.ast_mangle(ast);
            ast = pro.ast_squeeze(ast);
            var final_code = pro.gen_code(ast);
            aResponse.send(final_code);
        });
    }

    &#x2F;**
    * &#x60;[GET] .js&#x60; Returns JavaScript API view with all defined API operations
    * @method getApi
    *&#x2F;
    getApi(aRequest: any, aResponse: express.ExpressServerResponse) {
        this._getApi(aRequest, aResponse, function (err, str) {
            if (err) return aRequest.next(err);
            var ast = jsp.parse(str);
            var final_code = pro.gen_code(ast, {
                beautify: true
            });
            aResponse.send(final_code);
        });
    }
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
