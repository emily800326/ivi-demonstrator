<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\app.ts - Intel Tizen IVI Engine</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="https:&#x2F;&#x2F;www.tizen.org&#x2F;sites&#x2F;all&#x2F;themes&#x2F;tizen_theme&#x2F;logo.png" title="Intel Tizen IVI Engine"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.2012105.151454</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/AbstractService.AbstractService.html">AbstractService.AbstractService</a></li>
            
                <li><a href="..&#x2F;classes/AbstractService.AbstractServiceOptions.html">AbstractService.AbstractServiceOptions</a></li>
            
                <li><a href="..&#x2F;classes/AbstractService.EndpointAction.html">AbstractService.EndpointAction</a></li>
            
                <li><a href="..&#x2F;classes/AbstractService.EndpointActionParameter.html">AbstractService.EndpointActionParameter</a></li>
            
                <li><a href="..&#x2F;classes/ApiEndpointBase.ApiEndpointBase.html">ApiEndpointBase.ApiEndpointBase</a></li>
            
                <li><a href="..&#x2F;classes/AudioService.AudioService.html">AudioService.AudioService</a></li>
            
                <li><a href="..&#x2F;classes/AudioService.StatusData.html">AudioService.StatusData</a></li>
            
                <li><a href="..&#x2F;classes/CarIndicatorService.CarIndicatorService.html">CarIndicatorService.CarIndicatorService</a></li>
            
                <li><a href="..&#x2F;classes/CarIndicatorService.RandomizerData.html">CarIndicatorService.RandomizerData</a></li>
            
                <li><a href="..&#x2F;classes/CarIndicatorService.StatusData.html">CarIndicatorService.StatusData</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.AlphabetBookmark.html">com.intel.tizen.coulomb.2012.AlphabetBookmark</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.AudioPlayer.html">com.intel.tizen.coulomb.2012.AudioPlayer</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.BottomPanel.html">com.intel.tizen.coulomb.2012.BottomPanel</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.BoxCaption.html">com.intel.tizen.coulomb.2012.BoxCaption</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.ButtonControlsObj.html">com.intel.tizen.coulomb.2012.ButtonControlsObj</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Carousel.html">com.intel.tizen.coulomb.2012.Carousel</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Clock.html">com.intel.tizen.coulomb.2012.Clock</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.ClockPlugin.html">com.intel.tizen.coulomb.2012.ClockPlugin</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.global.html">com.intel.tizen.coulomb.2012.global</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.jQuery.html">com.intel.tizen.coulomb.2012.jQuery</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Library.html">com.intel.tizen.coulomb.2012.Library</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.MusicLibraryFileSystem.html">com.intel.tizen.coulomb.2012.MusicLibraryFileSystem</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.progressBarPlugin.html">com.intel.tizen.coulomb.2012.progressBarPlugin</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Settings.html">com.intel.tizen.coulomb.2012.Settings</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Tabs.html">com.intel.tizen.coulomb.2012.Tabs</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.Themes.html">com.intel.tizen.coulomb.2012.Themes</a></li>
            
                <li><a href="..&#x2F;classes/com.intel.tizen.coulomb.2012.TopBarIcons.html">com.intel.tizen.coulomb.2012.TopBarIcons</a></li>
            
                <li><a href="..&#x2F;classes/Engine.Server.html">Engine.Server</a></li>
            
                <li><a href="..&#x2F;classes/EventSourceDispatcher.EventSourceDispatcher.html">EventSourceDispatcher.EventSourceDispatcher</a></li>
            
                <li><a href="..&#x2F;classes/EventSourceDispatcher.EventUpdateData.html">EventSourceDispatcher.EventUpdateData</a></li>
            
                <li><a href="..&#x2F;classes/HomeScreenService.HomeScreenService.html">HomeScreenService.HomeScreenService</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.AvailablePackageData.html">PackageRepositoryService.AvailablePackageData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.CategoryData.html">PackageRepositoryService.CategoryData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.InstalledPackageData.html">PackageRepositoryService.InstalledPackageData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.PackageEventData.html">PackageRepositoryService.PackageEventData</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.PackageRepositoryOptions.html">PackageRepositoryService.PackageRepositoryOptions</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.PackageRepositoryService.html">PackageRepositoryService.PackageRepositoryService</a></li>
            
                <li><a href="..&#x2F;classes/PackageRepositoryService.ThemeData.html">PackageRepositoryService.ThemeData</a></li>
            
                <li><a href="..&#x2F;classes/PersistentConsole.console.html">PersistentConsole.console</a></li>
            
                <li><a href="..&#x2F;classes/ThemeEngineService.ThemeEngineService.html">ThemeEngineService.ThemeEngineService</a></li>
            
                <li><a href="..&#x2F;classes/TizenApplicationStubService.TizenApplicationStubService.html">TizenApplicationStubService.TizenApplicationStubService</a></li>
            
                <li><a href="..&#x2F;classes/UserStatusService.UserDetails.html">UserStatusService.UserDetails</a></li>
            
                <li><a href="..&#x2F;classes/UserStatusService.UserSettings.html">UserStatusService.UserSettings</a></li>
            
                <li><a href="..&#x2F;classes/UserStatusService.UserStatusService.html">UserStatusService.UserStatusService</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\app.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;&#x2F;&#x2F; &lt;reference path=&#x27;.&#x2F;extern&#x2F;express.d.ts&#x27;&#x2F;&gt;

&#x2F;**
 * @namespace Engine
 *&#x2F;

&#x2F;**
 * Module defines server-wide options and infrastucture used by other services.
 * 
 * Management console for IVI engine is by default located on http:&#x2F;&#x2F;localhost:8088 and displays available API endpoints as well as installed applications. 
 * Main application entry point is &#x60;Home Screen&#x60; application.
 * 
 * All API commands can be invoked either from web browser environment (e.g. http:&#x2F;&#x2F;localhost:8088&#x2F;packageRepository) or by manually (e.g. curl call). 
 *
 * All API services provides encapsulation JavaScript libraries that can be used from HTML applications (e.g. http:&#x2F;&#x2F;localhost:8088&#x2F;packageRepository.js). Minified version of all API services is available as well (e.g. http:&#x2F;&#x2F;localhost:8088&#x2F;packageRepository.min.js).
 * 
 * Management console also provides &#x60;[GET] &#x2F;shutdown&#x60; call which ternminates current server.
 * @class Server
 *&#x2F;

import index = module(&quot;.&#x2F;routes&#x2F;homeScreenService&quot;);
import userClass = module(&quot;.&#x2F;routes&#x2F;userStatusService&quot;);
import carIndicatorService = module(&quot;.&#x2F;routes&#x2F;carIndicatorService&quot;);
import audioService = module(&quot;.&#x2F;routes&#x2F;audioService&quot;);
import tizenApplicationStubService = module(&quot;.&#x2F;routes&#x2F;tizenApplicationStubService&quot;);
import packageRepositoryService = module(&quot;.&#x2F;routes&#x2F;packageRepositoryService&quot;);
import themeEngineService = module(&quot;.&#x2F;routes&#x2F;themeEngineService&quot;);
import eventSourceDispatcher = module(&quot;eventSourceDispatcher&quot;);
import path = module(&quot;path&quot;);
import fs = module(&quot;fs&quot;);
import os = module(&quot;os&quot;);
import http = module(&quot;http&quot;);

var express = require(&#x27;express&#x27;);
var log4js = require(&#x27;log4js&#x27;);
var ejsMiddleware = require(&#x27;ejs-middleware&#x27;);

&#x2F;**
 * Main server application. Use properties or environment variables tied to properties below to fine-tune server behavior.
 * @property app
 * @type {ExpressServer}
 * @for Server
*&#x2F;
var app = express();

&#x2F;**
 * Defines project root directory it is used as base for all other paths. Can be overriden by defining &#x60;ROOT_DIR&#x60; environment value.
 * @property rootDir
 * @default Startup directory of nodejs command (&#x60;__dirname&#x60;).
 * @for Server
 * @type {String}
*&#x2F;
var rootDir: string = process.env.ROOT_DIR || path.dirname(__dirname);

&#x2F;**
 * Base root folder of applications. This folder should contain all installed applications in separate directories, each with &#x60;config.xml&#x60; file otherwise they won&#x27;t be recognized as valid application.  
 * Can be overriden by defining &#x60;APPLICATIONS_DIR&#x60; environment value.
 * @property baseAppPath
 * @default &#x60;rootDir&#x60;&#x2F;..&#x2F;..&#x2F;applications
 * @type {String}
*&#x2F;
var baseAppPath: string = process.env.APPLICATIONS_DIR || path.join(path.dirname(path.dirname(rootDir)), &#x27;applications&#x27;);

&#x2F;**
 * TCP port on which application listens.
 * Can be overriden by defining &#x60;ENGINE_PORT&#x60; environment value.
 * @property port
 * @default 8088
 * @type {Integer}
*&#x2F;
var port: number = process.env.ENGINE_PORT || 8088;

&#x2F;**
 * Base root folder of themes. This folder should contain all installed themes in separate directories and subdirectories, each with &#x60;theme.json&#x60; file file otherwise they won&#x27;t be recognized as valid theme.
 * @property baseThemePath
 * @default &#x60;rootDir&#x60;&#x2F;themes
 * @type {String}
*&#x2F;
var baseThemePath: string = path.join(rootDir, &#x27;themes&#x27;);

&#x2F;**
 * Base root folder of default data files. This folder should contain all default data files for various services.
 * Can be overriden by defining &#x60;DATA_DIR&#x60; environment value.
 * @property dataDir
 * @default &#x60;rootDir&#x60;&#x2F;data
 * @type {String}
*&#x2F;
var dataDir: string = process.env.DATA_DIR || path.join(rootDir, &quot;data&quot;);

&#x2F;**
 * Toggles duplication of HTML5 applications console output into Engine log files. Applications must include &#x60;PersistentConsole.console&#x60; JavaScript file to enable this feature.
 * Can be overriden by defining &#x60;LAUNCH_WITH_PERSISTENT_CONSOLE&#x60; environment value. Use &#x60;1&#x60; to turn this feature on.
 *
 *      &lt;script type=&#x27;text&#x2F;javascript&#x27; src=&#x27;&#x2F;persistentConsole.js&#x27;&gt;&lt;&#x2F;script&gt;
 *
 * @property launchWithPersistentConsole
 * @default 0
 * @type {Integer}
*&#x2F;
var launchWithPersistentConsole: bool = process.env.LAUNCH_WITH_PERSISTENT_CONSOLE == 1 || false;

&#x2F;**
 * Toggles silent installation of new packages and themes from remote Package Repository.
 * Can be overriden by defining &#x60;SILENT_INSTALL&#x60; environment value. Use &#x60;1&#x60; to turn this feature on.
 * @property doSilentInstall
 * @default 0
 * @type {Integer}
*&#x2F;
var doSilentInstall = process.env.SILENT_INSTALL == 1;

&#x2F;**
 * Toggles if service should be password protected. If turned on all calls are Basic Authentication protected with username &#x60;intel&#x60; and password &#x60;TiZ3N456!&#x60;.
 * Can be overriden by defining &#x60;IS_PASSWORD_PROTECTED&#x60; environment value. Use &#x60;1&#x60; to turn this feature on.
 * @property isPasswordProtected
 * @default 0
 * @type {Integer}
*&#x2F;
var isPasswordProtected = process.env.IS_PASSWORD_PROTECTED == 1;

&#x2F;**
 * Defines remote Package Repository URL for latest package information.
 * Can be overriden by defining &#x60;LATEST_PACKAGES_URL&#x60; environment value.
 * @property latestPackagesUrl
 * @default &quot;http:&#x2F;&#x2F;80.242.18.56&#x2F;packages&#x2F;latest&quot;
 * @type {String}
*&#x2F;
var latestPackagesUrl = process.env.LATEST_PACKAGES_URL || &quot;http:&#x2F;&#x2F;80.242.18.56&#x2F;packages&#x2F;latest&quot;;

&#x2F;**
 * Defines remote Package Repository URL for all available package information.
 * Can be overriden by defining &#x60;AVAILABLE_PACKAGES_URL&#x60; environment value.
 * @property availablePackagesUrl
 * @default &quot;http:&#x2F;&#x2F;80.242.18.56&#x2F;packages&#x2F;available&quot;
 * @type {String}
*&#x2F;
var availablePackagesUrl = process.env.AVAILABLE_PACKAGES_URL || &quot;http:&#x2F;&#x2F;80.242.18.56&#x2F;packages&#x2F;available&quot;;

&#x2F;**
 * Defines device name for identification with Package Repository.
 * Can be overriden by defining &#x60;DEVICE_NAME&#x60; environment value.
 * @property deviceName
 * @default Device hostname
 * @type {String}
*&#x2F;
var deviceName = process.env.DEVICE_NAME || os.hostname();

if (!fs.existsSync(&quot;logs&quot;)) fs.mkdirSync(&quot;logs&quot;);

log4js.configure({
    appenders: [
        { type: &#x27;console&#x27; },
        {
            type: &#x27;file&#x27;,
            filename: &#x27;logs&#x2F;engine.log&#x27;,
            maxLogSize: 20480,
            backups: 3
        },
        {
            type: &quot;file&quot;,
            filename: &quot;logs&#x2F;applications.log&quot;,
            maxLogSize: 20480,
            backups: 3,
            category: &quot;Applications&quot;
        }
    ]
});

var logger: any = log4js.getLogger(&#x27;Server&#x27;);
var applicationLogger: any = log4js.getLogger(&#x27;Applications&#x27;);

logger.info(&quot;Application starting at port: %d&quot;, port);
logger.info(&quot;Application root dir: %s&quot;, rootDir);
logger.info(&quot;Application data dir: %s&quot;, dataDir);

app.configure(function () {
    app.use(log4js.connectLogger(logger, { level: log4js.levels.INFO }));
    app.set(&#x27;port&#x27;, port);
    app.set(&#x27;views&#x27;, path.join(rootDir, &quot;views&quot;));
    app.set(&#x27;view engine&#x27;, &#x27;ejs&#x27;);
    app.use(express.favicon());
    app.use(express.cookieParser());
    app.use(express.bodyParser());
    app.use(express.methodOverride());

    if (isPasswordProtected) {
        logger.info(&quot;Enabling password protection&quot;)
        app.use(express.basicAuth(&#x27;intel&#x27;, &#x27;TiZ3N456!&#x27;));
    }

    app.use(app.router);
    var publicDir: string = path.join(rootDir, &quot;public&quot;);
    app.use(require(&#x27;stylus&#x27;).middleware(publicDir));
    app.use(ejsMiddleware(path.join(publicDir, &quot;api&quot;), &quot;js&quot;));
    app.use(express.static(publicDir));

    if (!fs.existsSync(baseAppPath)) fs.mkdirSync(baseAppPath);
});

var eventDispatcher = new eventSourceDispatcher.EventSourceDispatcher();
eventDispatcher.attachApplication(app);

var carIndicator = new carIndicatorService.CarIndicatorService(eventDispatcher);
carIndicator.attachApplication(app);
new audioService.AudioService(eventDispatcher).attachApplication(app);

var packageRepository = new packageRepositoryService.PackageRepositoryService({
    baseApplicationPath: baseAppPath,
    baseThemePath: baseThemePath,
    baseDataPath: path.join(dataDir, &quot;packageRepository&quot;),
    doSilentInstall: doSilentInstall,
    latestPackagesUrl: latestPackagesUrl,
    availablePackagesUrl: availablePackagesUrl,
    deviceName: deviceName,
    engineVersion: JSON.parse(fs.readFileSync(path.join(rootDir, &quot;package.json&quot;)).toString()).version
});

packageRepository.attachApplication(app);
new tizenApplicationStubService.TizenApplicationStubService(packageRepository, eventDispatcher, launchWithPersistentConsole).attachApplication(app);
var themeEngine = new themeEngineService.ThemeEngineService(packageRepository, eventDispatcher, baseThemePath);
themeEngine.attachApplication(app);
new userClass.UserStatusService(themeEngine, carIndicator, packageRepository).attachApplication(app);

var homepage = new index.HomeScreenService(packageRepository, launchWithPersistentConsole);
app.get(&#x27;&#x2F;&#x27;, homepage.index.bind(homepage));
app.post(&#x27;&#x2F;log&#x27;, function (req, res) {
    try {
        var level = req.body.level;
        level = level == &quot;log&quot; ? &quot;info&quot; : level;
        var message = req.body.message;
        var referer = req.headers[&quot;referer&quot;];
        switch (level) {
            case &quot;info&quot;: applicationLogger.info(referer, message); break;
            case &quot;debug&quot;: applicationLogger.debug(referer, message); break;
            case &quot;warn&quot;: applicationLogger.warn(referer, message); break;
            case &quot;error&quot;: applicationLogger.error(referer, message); break;
        }
    } catch (ex) {
        logger.error(ex);
    }
    res.json({});
});

app.configure(&#x27;development&#x27;, function () {
    app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));
});

&#x2F;&#x2F;app.disable(&quot;view cache&quot;);

var server = http.createServer(app);

server.listen(app.get(&#x27;port&#x27;), function () {
    logger.info(&quot;Express server listening on port %d&quot;, app.get(&#x27;port&#x27;));
});

app.get(&#x27;&#x2F;shutdown&#x27;, function (aRequest, aResponse) {
    logger.info(&quot;Shutdown command arrived&quot;);
    aResponse.write(&quot;OK&quot;);
    aResponse.end(&#x27;\n&#x27;);
    server.close();
    process.exit();
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
